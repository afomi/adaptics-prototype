<!DOCTYPE html>
<html>
<head>
	<title>
		Adaptics - non-geographical maps
	</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js" integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg==" crossorigin=""></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<style media="screen">
		html, body {
			height: 100%
		}

		.bottom-drawer {
			height: 75px;
		}
	</style>
</head>
<body>
<div id="mapid" style="width: 100%; height: calc(100% - 75px)"></div>
<script
  src="https://code.jquery.com/jquery-3.4.0.slim.js"
  integrity="sha256-milezx5lakrZu0OP9b2QWFy1ft/UEUK6NH1Jqz8hUhQ="
  crossorigin="anonymous"></script>
<script>
	var mymap = L.map('mapid').setView([51.505, -0.09], 13);

	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 3,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(mymap);

	L.marker([51.5, -0.09]).addTo(mymap)
		.bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();

	L.circle([51.508, -0.11], 500, {
		color: 'red',
		fillColor: '#f03',
		fillOpacity: 0.5
	}).addTo(mymap).bindPopup("I am a circle.");

	L.polygon([
		[51.509, -0.08],
		[51.503, -0.06],
		[51.51, -0.047]
	]).addTo(mymap).bindPopup("I am a polygon.");

	L.circle([51.508, -0.11], 500, {
		color: 'red',
		fillColor: '#f03',
		fillOpacity: 0.5
	}).addTo(mymap).bindPopup("I am a circle.");

	var bounds = [[54.559322, -5.767822], [56.1210604, -3.021240]];
	// create an orange rectangle
	var box1 = L.rectangle(bounds, {color: "#ff7800", weight: 1}).addTo(mymap);


	var popup = L.popup();

	function onMapClick(e) {
		popup
			.setLatLng(e.latlng)
			.setContent("You clicked the map at " + e.latlng.toString())
			.openOn(mymap);
	}

	mymap.on('click', onMapClick);
	mymap.on("click", function(e) {
		clickHandler(e);
	})

// 	var latlngs = [
//     [45.51, -122.68],
//     [37.77, -122.43],
//     [34.04, -118.2]
// ];
// 	var polyline = L.polyline(latlngs, {color: 'red'}).addTo(map);
// 	// zoom the map to the polyline
// 	map.fitBounds(polyline.getBounds());

	function clickHandler(e) {
		var lat = e.latlng.lat;
		var lng = e.latlng.lng;
		var bounds = [[lat, lng], [lat+2, lng+2]];
		drawRectangle(bounds)
	}

	// Draw a line between this rectangle and Box1
	function drawLineToBox1(box) {
		// draw a polyline between box1 and box
			var latlngs = [
		    [box.getLatLngs()[0][0].lat, box.getLatLngs()[0][0].lng],
		    [box1.getLatLngs()[0][0].lat, box1.getLatLngs()[0][0].lng],
		];
		var polyline = L.polyline(latlngs, {color: 'red'}).addTo(mymap);

		// NEEDS TO BE SPLIT OUT
		var myIcon = L.divIcon({className: 'my-div-icon', html: "STRRRRNG"});
		// you can set .my-div-icon styles in CSS
		L.marker([box.getLatLngs()[0][0].lat, box.getLatLngs()[0][0].lng], {icon: myIcon}).addTo(mymap);
	}

	function drawRectangle(bounds) {
		// create an orange rectangle
		var box = L.rectangle(bounds, {color: "#ff7800", weight: 1}).addTo(mymap);
		box.attributes = {};
		// free form
		box.attributes.freeFormX = (mymap.project(box.getCenter()).x); // not pixel X (map X)
		box.attributes.freeFormY = (mymap.project(box.getCenter()).y);
		// 2X2 attributes (x, y axes)
		box.attributes.effort =  Math.random() * 100;
		box.attributes.value = Math.random() * 100;
		// Aging (horizontally)
		box.attributes.daysOld = Math.random() * 365;
		// Sort by Story Size (vertically)
		box.attributes.storySize = Math.random() * 10;

		drawLineToBox1(box);
	}

	// Set the Space type...

	// TRIGGER 2X2
	// TRIGGER SIZE SORT
	// TRIGGER AGE SORT
	// TRIGGER FREE FORM

	function drawFreeForm() {
		// for each Rectangle
		// re-draw based on effort/value functional coordinates...
		mymap.eachLayer(function(layer) {
			if(!layer.attributes || (layer.attributes && !layer.attributes.freeFormX)) {
				return true
			}
			// EFFORT / VALUE
			var point = L.point(layer.attributes.freeFormX, layer.attributes.freeFormY)

			var lat = mymap.unproject(point, mymap.getZoom()).lat;
			var lng = mymap.unproject(point, mymap.getZoom()).lng;
			console.log(lat, lng)
			var bounds = [[lat, lng], [lat + 5, lng + 5]];
			layer.setBounds(bounds);
		})
	}

	function draw2x2() {
		// for each Rectangle
		// re-draw based on effort/value functional coordinates...
		mymap.eachLayer(function(layer) {
			if(!layer.attributes) {
				return true
			}
			// EFFORT / VALUE
			var bounds = [[layer.attributes.effort, layer.attributes.value], [layer.attributes.effort + 5, layer.attributes.value + 5]];
			layer.setBounds(bounds);
		})
	}

	function drawAgeSort() {
		var i = 0;
		// for each Rectangle
		// re-draw based on effort/value functional coordinates...
		mymap.eachLayer(function(layer) {
			if(!layer.attributes) {
				return true
			}
			// translate days old into vertical coordinates
			function translateCoords(days) { // accepts days 0 - 365
				return 365 / days;
			}
			var x = translateCoords(layer.attributes.daysOld)
			var y = mymap.getCenter().lng + (i * 7);
			var bounds = [[x, y], [x + 5, y + 5]];
			layer.setBounds(bounds);
		})
	}

	function drawSizeSort() {
		// for each Rectangle
		// re-draw based on effort/value functional coordinates...
		var mapWidth = $("#mapid").width();
		var xAxis = d3.scaleLinear().domain([0, 365]).range([0, mapWidth]);

		mymap.eachLayer(function(layer) {
			if(!layer.attributes) {
				return true;
			}

			// Translate Age to range. Maybe D3?
			// Create the Axes range using fancy D3
			// Days Min/Max
			var effort = layer.attributes.effort;
			var x = xAxis(effort);

			// Boundaries of the map
			mymap.getBounds().getNorthEast();
			mymap.getBounds().getSouthWest();

			// Age
			// var bounds = [[layer.attributes.effort, layer.attributes.value], [layer.attributes.effort + 5, layer.attributes.value + 5]];
			// layer.setBounds(bounds);
		})
	}

	// DUMMY UP SOME OBJECTS FOR US
	// for(var i=0; i < 10; i++) {
	// 	var bounds = [[54.559322, -5.767822 + Math.random() * 5], [56.1210604, -3.021240 +  Math.random() * 5]];
	// 	drawRectangle(bounds);
	// }

	$(function() {
		$("#draw2x2").on("click", function() {
			draw2x2();
		});
		$("#drawAgeSort").on("click", function() {
			drawAgeSort();
		});
		$("#drawSizeSort").on("click", function() {
			drawSizeSort();
		});
		$("#drawFreeForm").on("click", function() {
			drawFreeForm();
		});
	});
</script>

	<div class="bottom-drawer">
		<a href="#" id="draw2x2">Draw 2X2</a> &middot;
		<a href="#" id="drawAgeSort">Sort by Age</a> &middot;
		<a href="#" id="drawSizeSort">Sort by Size</a> &middot;
		<a href="#" id="drawFreeForm">Free Form</a>
	</div>
</body>
</html>
